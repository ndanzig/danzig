<!-- output file generated by BM Utilities -->
<html>

<p><a href="./3376fm.html"><img src="fm2html-toc.gif">Table of Contents</a>  <a href="3376c27.html#H166"><img src="fm2html-previous.gif">IGMP
Operation</a><br>
<head>
<title>
TCP/IP Tutorial and Technical Overview
</title>
<body>

<h2><a name="arp">2.8  Address Resolution Protocol (ARP)</a>
</h2>
<br><br><a name=figarpa>
<img src="3376arp.gif"></a>
<br><i>Figure: Address Resolution Protocol (ARP)</i><br><br>
<p>The ARP protocol is a <i>network-specific standard protocol</i>. Its status
is <i>elective</i>.
<p>The address resolution protocol is responsible for converting the
higher-level protocol addresses (IP addresses) to physical network addresses.
First, let's consider some general topics on Ethernet.

<h3><a name="H170">2.8.1  Ethernet versus IEEE 802.3</a>
</h3>
<p><a name=index857>Two</a> frame formats can be used on the Ethernet coaxial
cable:
<ol>
<li>The standard issued in 1978 by Xerox Corporation, Intel Corporation and
Digital Equipment Corporation, usually called <i>Ethernet</i> (or <i>DIX</i>
Ethernet).
<li>The international IEEE 802.3 standard, a more recently defined standard.
</ol>
The difference between the two standards is in the use of one of the header
fields, which contains a protocol-type number for Ethernet and the length of
the data in the frame for IEEE 802.3.
<br><br><a name=figethfram>
<img src="3376f37.gif"></a>
<br><i>Figure: Frame Formats for Ethernet and IEEE 802.3</i><br><br>
<ul>
<li><a name=index858>The</a> type field in Ethernet is used to distinguish
between different protocols running on the coaxial cable, and allows their
coexistence on the same physical cable.
<li>The maximum length of an Ethernet frame is 1526 bytes. This means a data
field length of up to 1500 bytes. The length of the 802.3 data field is also
limited to 1500 bytes for 10 Mbps networks, but is different for other
transmission speeds.
<li>In the 802.3 MAC frame, the length of the data field is indicated in the
802.3 header. The type of protocol it carries is then indicated in the 802.2
header (higher protocol level)/, see
<a href="3376c28.html#figethfram">Figure - Frame Formats for Ethernet and IEEE
802.3</a>
<li>In practice however, both frame formats can coexist on the same physical
coax. This is done by using protocol type numbers (type field) greater than
1500 in the Ethernet frame. However, different device drivers are needed to
handle each of these formats.
</ul>
<p>Thus, for all practical purposes, the Ethernet physical layer and the IEEE
802.3 physical layer are compatible. However, the Ethernet data link layer and
the IEEE 802.3/802.2 data link layer are incompatible.

<h5><a name="H172">The 802.2 Logical Link Control (LLC) layer</a>
</h5>
<a name=index859>above</a> IEEE 802.3 <a name=index860>uses</a> a concept known
as <i>Link Service Access Point</i> (LSAP) which uses a 3-byte header:
<br><br><a name=fig>
<img src="3376f38.gif"></a>
<br><i>Figure: IEEE 802.2 LSAP Header</i><br><br>
<a name=index864>where</a> DSAP and SSAP stand for Destination and Source
Service Access Point respectively. Numbers for these fields are assigned by an
IEEE committee.
<p>Due to a growing number of applications using IEEE 802 as lower protocol
layers, an extension was made to the IEEE 802.2 protocol in the form
<a name=index866>of</a> the Sub-Network Access Protocol (SNAP). It is an
extension to the LSAP header above, and its use is indicated by the value 170
in both the SSAP and DSAP fields of the LSAP frame above.
<br><br><a name=fig>
<img src="3376f39.gif"></a>
<br><i>Figure: IEEE 802.2 SNAP Header</i><br><br>

<h5><a name="H175">In the evolution of TCP/IP,</a>
</h5>
<a name=index868>three</a> standards were established, which describe the
encapsulation of IP and ARP frames on these networks:
<ol>
<li><a name=index869>1984</a>: <i>RFC 894 - Standard for the Transmission of IP
Datagrams over Ethernet Networks</i> specifies only the use of Ethernet type of
networks. The values assigned to the type field are:
<dl>
<dt>
2048 (hex 0800)
<dd>for IP datagrams
<dt>
2054 (hex 0806)
<dd>for ARP datagrams
</dl>
<li><a name=index870>1985</a>: <i>RFC 948 - Two Methods for the Transmission of
IP Datagrams over IEEE 802.3 Networks</i> specifies two possibilities:
<ol>
<li>The Ethernet compatible method:  the frames are sent on a real IEEE 802.3
network in the same fashion as on an Ethernet network, that is, using the IEEE
802.3 data-length field as the Ethernet type field, thereby violating the IEEE
802.3 rules, but compatible with an Ethernet network.
<li>IEEE 802.2/802.3 LLC type 1 format: using 802.2 LSAP header with IP using
the value 6 for the SSAP and DSAP fields.
</ol>
<p>The RFC indicates clearly that the IEEE 802.2/802.3 method is the preferred
method, that is, that all future IP implementations on IEEE 802.3 networks are
supposed to use the second method.
<li><a name=index871>1987</a>: <i>RFC 1010 - Assigned Numbers</i> (now
obsoleted by RFC 1700 dated 1994) notes that as a result of IEEE 802.2
evolution and the need for more internet protocol numbers, a new approach was
developed based on practical experiences exchanged during the August 1986 TCP
Vendors Workshop. It states in an almost completely overlooked part of this RFC
that from now on all IEEE 802.3, 802.4 and 802.5 implementations
<a name=index874>should</a> use the Sub-Network Access Protocol (SNAP) form of
<a name=index875>the</a> IEEE 802.2 LLC: DSAP and SSAP fields set to 170
(indicating the use of SNAP) and then SNAP assigned as follows:
<ul>
<li>0 (zero) as organization code.
<li>EtherType field:
<dl>
<dt>
2048 (hex 0800)
<dd>for IP datagrams
<dt>
2054 (hex 0806)
<dd>for ARP datagrams
<dt>
32821 (hex 8035)
<dd><a name=index876>for</a> RARP datagrams
</dl>
These are the same values as used in the Ethernet type field.
</ul>
<li><a name=index877>1988</a>: <i>RFC 1042 - Standard for the Transmission of
IP Datagrams over IEEE 802 Networks</i>.
<p>As this new approach (very important for implementations) passed almost
unnoticed in a little note of an unrelated RFC, it became quite confusing, and
finally, in February 1988, it was repeated in an RFC on its own: <i>RFC
1042</i>, which obsoletes <i>RFC 948</i>.
</ol>
The relevant IBM TCP/IP products implement RFC 894 for DIX Ethernet and RFC1010
(now RFC 1700) for IEEE 802.3 networks.
<p>However, in practical situations, there are still TCP/IP
<a name=index879>implementations</a> that use the older LSAP method (RFC 948 or
1042). <i>Such implementations will not communicate with the more recent
implementations (such as IBM's).</i>
<p>Note also that the last method covers not only the IEEE 802.3 networks, but
also the IEEE 802.4 and 802.5 networks such as the IBM Token-Ring LAN.

<h3><a name="H176">2.8.2  ARP Overview</a>
</h3>
<p><a name=index880>On</a> a single physical network, individual hosts are
known on the network by their physical hardware address. Higher-level protocols
address destination hosts in the form of a symbolic address (IP address in this
case).  When such a protocol wants to send a datagram to destination IP address
w.x.y.z, the device driver does not understand this address.
<p>Therefore, a module (ARP) is provided that will translate the IP address to
the physical address of the destination host. It uses a lookup table (sometimes
referred to as the <i>ARP cache</i><a name=index882>)</a> to perform this
translation.
<p>When the address is not found in the ARP cache, a broadcast is sent out on
the network, with a special format called the <i>ARP request.</i> If one of the
machines on the network recognizes its own IP address in the request, it will
send an <i>ARP reply</i> back to the requesting host. The reply will contain
the physical hardware address of the host and source route information (if the
packet has crossed bridges on its path). Both this address and the source route
information are stored in the ARP cache of the requesting host. All subsequent
datagrams to this destination IP address can now be translated to a physical
address, which is used by the device driver to send out the datagram on the
network.
<p>ARP was designed to be used on networks that support hardware broadcast.
This means, for example, that ARP will not work on an X.25 network.

<h3><a name="H177">2.8.3  ARP Detailed Concept</a>
</h3>
<p><a name=index883>ARP</a> is used on IEEE 802 networks as well as on the
older DIX Ethernet networks to map IP addresses to physical hardware addresses.
To do this, it is closely related to the device driver for that network. In
fact, the ARP specifications in <a name=index884>RFC</a> 826 only describe its
functionality, not its implementation. The implementation depends to a large
extent on the device driver for a network type and they are usually coded
together in the <i>adapter microcode</i>.

<h4><a name="arppg">2.8.3.1  ARP Packet Generation</a>
</h4>
<p><a name=index885>If</a> an application wishes to send data to a certain IP
destination address, the IP routing mechanism first determines the IP address
of the ``next hop'' of the packet (it can be the destination host itself, or a
router) and the hardware device on which it should be sent. If it is an IEEE
802.3/4/5 network, the ARP module must be consulted to map the &lt;protocol
type, target protocol address&gt; to a physical address.
<p>The ARP module tries to find the address in this ARP cache. If it finds the
matching pair, it gives the corresponding 48-bit physical address back to the
caller (the device driver) which then transmits the packet. If it doesn't find
the pair in its table, it <i>discards the packet</i> (assumption is that a
higher-level protocol will retransmit) and generates a network <i>broadcast</i>
of an ARP request.
<br><br><a name=figarppack>
<img src="3376f40.gif"></a>
<br><i>Figure: ARP Request/Reply Packet</i><br><br>
<a name=index886>Where</a>:
<dl>
<dt>
Hardware address space
<dd>Specifies the type of hardware; examples are Ethernet or Packet Radio Net.
<dt>
Protocol address space
<dd>Specifies the type of protocol, same as EtherType field in the IEEE 802
header (IP or ARP).
<dt>
Hardware address length
<dd>Specifies the length (in bytes) of the hardware addresses in this packet.
For IEEE 802.3 and IEEE 802.5 this will be 6.
<dt>
Protocol address length
<dd>Specifies the length (in bytes) of the protocol addresses in this packet.
For IP this will be 4.
<dt>
Operation code
<dd>Specifies whether this is an ARP request (1) or reply (2).
<dt>
Source/target hardware address
<dd>Contains the physical network hardware addresses. For IEEE 802.3 these are
48-bit addresses.
<dt>
Source/target protocol address
<dd>Contains the protocol addresses. For TCP/IP these are the 32-bit IP
addresses.
</dl>
<p>For the ARP request packet, the target hardware address is the only
undefined field in the packet.

<h4><a name="H180">2.8.3.2  ARP Packet Reception</a>
</h4>
<p><a name=index887>When</a> a host receives an ARP packet (either a broadcast
request or a point-to-point reply), the receiving device driver passes the
packet to the ARP module which treats it as shown in
<a href="3376c28.html#figarpb">Figure - ARP Packet Reception</a>.
<br><br><a name=figarpb>
<img src="3376f41.gif"></a>
<br><i>Figure: ARP Packet Reception</i><br><br>
<p>The requesting host will receive this ARP reply, and will follow the same
algorithm to treat it. As a result of this, the triplet &lt;protocol type,
protocol address, hardware address&gt; for the desired host will be added to
its lookup table (ARP cache). The next time a higher-level protocol wants to
send a packet to that host, the ARP module will find the target hardware
address and the packet will be sent to that host.
<p>Note that because the original ARP request was a broadcast on the network,
all hosts on that network will have updated the sender's hardware address in
their table (only if it was already in the table).

<h3><a name="arpsubn">2.8.4  ARP and Subnets</a>
</h3>
<p><a name=index888>The</a> ARP protocol remains unchanged in the presence of
subnets. Remember that each IP datagram first goes through the IP routing
algorithm. This algorithm selects the hardware device driver which should send
out the packet. Only then, the ARP module associated with that device driver is
consulted.

<h3><a name="proxarp">2.8.5  Proxy-ARP or Transparent Subnetting</a>
</h3>
<p><a name=index889>Proxy-ARP</a> is described in <i>RFC 1027 - Using ARP to
Implement Transparent Subnet Gateways</i>, which is in fact a subset of the
method proposed in <i>RFC 925 - Multi-LAN Address Resolution</i>.
<a name=index890>It</a> is another method to construct local subnets, without
the need for a modification to the IP routing algorithm, but with modifications
to the routers, which interconnect the subnets.

<h4><a name="arpprox">2.8.5.1  Proxy-ARP Concept</a>
</h4>
<p><a name=index891>Consider</a> one IP network, which is divided into subnets,
interconnected by routers. We use the ``old'' IP routing algorithm, which means
that no host knows about the existence of multiple physical networks. Consider
hosts A and B which are on different physical networks within the same IP
network, and a router R between the two subnetworks:
<br><br><a name=figipa>
<img src="3376f42.gif"></a>
<br><i>Figure: Hosts Interconnected by a Router</i><br><br>
When host A wants to send an IP datagram to host B, it first has to determine
the physical network address of host B through the use of the ARP protocol.
<p>As host A cannot differentiate between the physical networks, his IP routing
algorithm thinks that host B is on the local physical network and sends out a
broadcast ARP request. Host B doesn't receive this broadcast, but router R
does. Router R understands subnets, that is, it runs the ``subnet'' version of
the IP routing algorithm and it will be able to see that the destination of the
ARP request (from the target protocol address field) is on another physical
network. If router R's routing tables specify that the next hop to that other
network is through a different physical device, it will reply to the ARP <i>as
if it were host B</i>, saying that the network address of host B is that of the
router R itself.
<p><a name=index892>Host</a> A receives this ARP reply, puts it in his cache
and will send future IP packets for host B to the router R. The router will
forward such packets to the correct subnet.
<p>The result is transparent subnetting:
<ul>
<li>Normal hosts (such as A and B) don't know about subnetting, so they use the
``old'' IP routing algorithm.
<li>The routers between subnets have to:
<ol>
<li>Use the ``subnet'' IP algorithm.
<li>Use a modified ARP module, which can reply on behalf of other hosts.
</ol>
</ul>
<br><br><a name=figipc>
<img src="3376f43.gif"></a>
<br><i>Figure: Proxy-ARP Router</i><br><br>
<a name=index893>The</a> IBM TCP/IP products do <i>not</i> implement proxy-ARP
routing.

<p><a href="./3376fm.html"><img src="fm2html-toc.gif">Table of Contents</a>  <a href="3376c29.html#rarp"><img src="fm2html-next.gif">Reverse
Address Resolution Protocol (RARP)</a><br>
</html>
