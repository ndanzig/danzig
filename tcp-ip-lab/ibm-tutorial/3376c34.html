<!-- output file generated by BM Utilities -->
<html>

<p><a href="./3376fm.html"><img src="fm2html-toc.gif">Table of Contents</a>  <a href="3376c33.html#H372"><img src="fm2html-previous.gif"><a name=index1287>Co-existence</a>
of TCP/IP and OSI Routing Protocols without IS-IS</a><br>
<head>
<title>
TCP/IP Tutorial and Technical Overview
</title>
<body>

<h2><a name="erp">3.4  Exterior Routing Protocols</a>
</h2>
<p><i>Exterior Routing Protocols</i> <a name=index1290>or</a> <i>Exterior
Gateway Protocols (EGPs)</i> are used to exchange routing information between
routers in different autonomous systems.
<p><b>Note:</b> The term Exterior Routing Protocol has no abbreviation in
common use, so we shall use the abbreviation EGP as is usual in TCP/IP
literature.
<p>Two EGPs are in common use
<ul>
<li><a name=index1291>Exterior</a> Gateway Protocol (see
<a href="3376c34.html#egp">Exterior Gateway Protocol (EGP)</a>).
<li><a name=index1292>Border</a> Gateway Protocol (see
<a href="3376c34.html#bgp">Border Gateway Protocol (BGP)</a>).
</ul>
EGP is being replaced progressively by BGP.  We shall discuss the two protocols
in turn.

<h3><a name="egp">3.4.1  Exterior Gateway Protocol (EGP)</a>
</h3>
<p><a name=index1293>EGP</a> is a <i>standard protocol</i>. Its status is
<i>recommended</i>.
<p>The Exterior Gateway Protocol is the protocol used for
<a name=index1294>exchange</a> of routing information between <i>exterior</i>
gateways (not belonging to the same autonomous system).
<p>EGP gateways may only forward reachability information for networks within
their autonomous system. This routing information must be collected by this EGP
gateway, usually via an <i>Interior Gateway Protocol</i> (IGP), used to
exchange information between gateways within an autonomous system (see
<a href="3376c32.html#figarpacor">Figure - The ARPANET Backbone</a>).
<p>EGP is based on periodic polling using <i>Hello/I Hear You</i> message
exchanges, to monitor neighbor reachability and poll requests to solicit update
responses. EGP restricts exterior gateways by allowing them to advertise only
those destination networks reachable entirely within that gateway's autonomous
system. Thus, an exterior gateway using EGP passes along information to its EGP
neighbors but does not advertise reachability information about its EGP
neighbors (gateways are neighbors if they exchange routing information) outside
the autonomous system. <a name=index1295>It</a> has three main features:
<ul>
<li>It supports a <i>neighbor acquisition protocol</i>. Two gateways may be
regarded as neighbors if they are connected by an <i>internet</i> which is
transparent to them. EGP does not specify the way in which one gateway
initially decides that it wants to become a neighbor of another. To become a
neighbor it must send an <i>Acquisition confirm</i> message as a response to an
<i>Acquisition Request</i> message. This step is necessary to obtain routing
information from another gateway.
<li>It supports a <i>neighbor reachability protocol</i>. It is used by a
gateway to keep real-time information as to the reachability of its neighbors.
The EGP protocol provides two message types for that purpose: a <i>Hello</i>
message and an <i>I Hear You</i> message (response to Hello).
<li>It supports update messages (also called <i>network reachability (NR)
messages</i>) that carry routing information. No gateway is required to send NR
messages to any other gateway, except as a response to a <i>poll request</i>.
</ul>
<p><a name=index1296>To</a> perform these three basic functions, EGP defines 10
message types:
<dl>
<dt>
Acquisition Request
<dd>Request a gateway to become a neighbor (or peer)
<dt>
Acquisition Confirm
<dd>Positive response to acquisition request
<dt>
Acquisition Refuse
<dd>Negative response to acquisition request
<dt>
Cease Request
<dd>Request termination of neighbor relationship
<dt>
Cease Confirm
<dd>Confirmation response to cease request
<dt>
Hello
<dd>Request neighbor to respond if alive
<dt>
I Hear You
<dd>Response to Hello message
<dt>
Poll Request
<dd>Request network routing table
<dt>
Routing Update
<dd>Network reachability information
<dt>
Error
<dd>Response to incorrect message
</dl>
<p>Let us consider the EGP routing update message shown in
<a href="3376c34.html#figegp">Figure - EGP Routing Update Message</a>.
<br><br><a name=figegp>
<img src="3376f90.gif"></a>
<br><i>Figure: EGP Routing Update Message</i><br><br>
<p><a name=index1297>The</a> different fields are as follows (the EGP header is
not <a name=index1298>considered;</a> refer to RFC 904 for more details):
<dl>
<dt>
#Int GW
<dd>Number of interior gateways (in the AS) appearing in this message.
<dt>
#Ext GW
<dd>Number of exterior gateways (outside the AS) appearing in this message.
<dt>
IP Source Network
<dd>The IP network number about which all reachability is measured.
<dt>
GW1 IP addr
<dd>IP address (without network number) of the gateway from which the distances
are measured.
<dt>
#Dist.
<dd>Number of distances in the gateway block.
<dt>
Dist.Da
<dd>Distance value.
<dt>
#Net Da
<dd>Number of networks at a given distance (Da).
<dt>
Net1 at distance Da
<dd>IP network number reachable via GW1 and at distance Da from GW1.
</dl>
<p>As indicated above, the EGP routing information messages associate a
<i>distance</i> qualifier to each route. But, EGP <i>does not interpret these
distance values</i>. They merely serve as an indication of the reachability or
unreachability of a network (a value of 255 means that the network is
unreachable). The value cannot be used to compute the shorter of two routes
unless those routes are both contained within a single autonomous system. For
this reason, EGP cannot be used as a routing algorithm. As a result there will
be only one path from the exterior gateway to any network.
<p>EGP is gradually being replaced by the more functional Border Gateway
Protocol (BGP).  For a more detailed description of BGP refer to the next
section.

<h3><a name="bgp">3.4.2  Border Gateway Protocol (BGP)</a>
</h3>
<p><b>Note:</b> <a name=index1301>There</a> are four different versions of BGP
defined. Where BGP is specified without a version number, it normally refers to
BGP Version 3 unless the document pre-dates the publication of the BGP-3
definition. BGP-3 is described in this section and BGP-4 in
<a href="3376c34.html#bgp4">Border Gateway Protocol Version 4 (BGP-4)</a>.
<a name=index1303>BGP-1</a> and BGP-2, described in <a name=index1305>RFC</a>
1105 and RFC 1163, are obsolete. Changes from BGP-1 and BGP-2 to BGP-3 are
documented in Appendix 2 and 3 of RFC 1267.

<h4><a name="bgp3">3.4.2.1  Border Gateway Protocol Version 3 (BGP-3)</a>
</h4>
<p>BGP-3 is a <i>draft standard protocol</i>. Its status is <i>elective</i>.
<a name=index1306>It</a> is described in RFC 1267.
<p>BGP-3 is an <i>inter-Autonomous System</i> (inter-AS) routing protocol based
on experience gained from EGP (see <a href="3376c34.html#egp">Exterior Gateway
Protocol (EGP)</a>). Unlike other routing protocols which communicate via
packets or datagrams, BGP-3 is <i>connection oriented</i>; it uses
<a name=index1307>TCP</a> as a transport protocol. The well-known port number
is 179. See <a href="3376c212.html#tcp">Transmission Control Protocol (TCP)</a>
for information on TCP and port numbers.
<p>Recall that the EGP was designed as a protocol to exchange
<i>reachability</i> information between autonomous systems, rather than a true
<i>routing</i>  protocol. Because inter-AS routing information is not
available, EGP cannot detect the presence of a loop caused by a set of EGP
routers all believing that one of the others can reach another AS to which none
of them is connected. A further problem with EGP has to do with the amount of
information exchanged; as the number of IP networks <a name=index1308>known</a>
to the NSFNET increased, the size of the EGP Neighbor Reachability (NR)
messages became quite large and the amount of time it took to process them
became significant.
<p>BGP-3 has replaced EGP in the <a name=index1309>NSFNET</a> backbone for
these reasons. However, BGP-3 as described in RFC 1268 does not require the
NSFNET or any other backbone to play any central role. Compare this to the Core
System role played by the ARPANET in the early days of the Internet. Instead,
BGP-3 views the Internet as an arbitrary collection of autonomous systems, and
it does not take account of the internal topology of an AS nor of the IGP (or
possibly multiple IGPs) used within an AS.
<p>Before giving an overview of BGP-3 operation, we shall define some terms
used in BGP-3:
<dl>
<dt>
BGP speaker
<dd><a name=index1310>A</a> system running BGP.
<dt>
BGP neighbors
<dd><a name=index1311>A</a> pair of BGP speakers exchanging inter-AS routing
information. BGP neighbors may be of two types:
<dl>
<dt>
Internal
<dd><a name=index1312>A</a> pair of BGP speakers in the same autonomous system.
Internal BGP neighbors must present a consistent image of the AS to their
External BGP neighbors. This is explained in more detail below.
<dt>
External
<dd><a name=index1313>A</a> pair of BGP neighbors in different autonomous
systems. External BGP neighbors must be connected by a BGP connection as
defined below. This restriction means that in most cases where an AS has
multiple BGP inter-AS connections, it will also require multiple BGP speakers.
</dl>
<dt>
BGP session
<dd><a name=index1314>A</a> TCP session between BGP neighbors which are
exchanging routing information using BGP. The neighbors monitor the state of
the session by sending a <i>keepalive</i> <a name=index1315>message</a>
regularly (the recommended interval is 30 seconds).
<a href=3376footnotes.html#footnote9>(9)</a>
<dt>
AS Border Router (ASBR)
<dd>A router which has a connection to multiple autonomous systems.
<p><b>Note:</b> The nomenclature for this type of router is somewhat varied.
<a name=index1316>RFC</a> 1583, which describes OSPF, uses the term <i>AS
Boundary Router</i>. <a name=index1318>RFC</a> 1267 and 1268, which describe
BGP-3, use the terms <i>Border Router</i> and <i>Border Gateway</i>.
<a name=index1319>RFC</a> 1340, which describes the interaction between OSPF
and BGP-3, uses the term <i>AS Border Router</i>. We shall use the last term
consistently when describing both OSPF and BGP. BGP-3 defines two types of AS
Border Router, depending on its topological relationship to the BGP speaker
which refers to it.
<dl>
<dt>
internal
<dd><a name=index1320>A</a> next hop router in the same AS as the BGP speaker.
<dt>
external
<dd><a name=index1321>A</a> next hop router in a different AS from the BGP
speaker.
</dl>
The IP address of a border router is specified as a next hop destination when
BGP-3 advertises an AS path (see below) to one of its external neighbors. Next
hop border routers must share a physical connection (see below) with both the
sending and receiving BGP speakers. If a BGP speaker advertises an external
border router as a next hop, that router must have been learned of from one of
that BGP speaker's peers.
<dt>
AS connection
<dd>BGP-3 defines two types of inter-AS connection.
<dl>
<dt>
physical connection
<dd><a name=index1322>An</a> AS shares a physical network with another AS, and
this network is connected to at least one border router from each AS. Since
these two routers share a network, they can forward packets to each other
without requiring any inter-AS or intra-AS routing protocols (that is, they
require neither an IGP nor an EGP to communicate).
<dt>
BGP connection
<dd><a name=index1323>A</a> BGP connection means that there is a BGP session
between a pair of BGP speakers, one in each AS, and this session is used to
communicate the routes through the physically connected border routers that can
be used for specific networks. BGP-3 requires that the BGP speakers must be on
the same network as the physically connected border routers so that the BGP
session is also independent of all inter-AS or intra-AS routing protocols. The
BGP speakers do not need to be border routers, and vice versa. In fact, BGP
speakers do not need to be routers: it is quite feasible for a host to provide
the BGP function and to pass exterior routing information to one or more border
routers with another protocol.
<p><b>Note:</b> The term BGP connection can be used to refer to a session
between two BGP speakers in the same AS.
</dl>
<dt>
Traffic type
<dd>BGP-3 categorizes traffic in an AS as one of two types:
<dl>
<dt>
<a name=index1324>local</a>
<dd>Local traffic is traffic which either originates in or terminates in that
AS. That is, either the source or the destination IP address is in the AS.
<dt>
transit
<dd><a name=index1326>Transit</a> traffic is all non-local traffic.
</dl>
One of the goals of BGP is to minimize the amount of transit traffic.
<dt>
AS Type
<dd>An AS is categorized as one of three types:
<dl>
<dt>
stub
<dd><a name=index1327>A</a> stub AS has a single inter-AS connection to one
other AS. A stub AS only carries local traffic.
<dt>
multihomed
<dd><a name=index1328>A</a> multihomed AS has connections to more than one
other AS but refuses to carry transit traffic.
<dt>
transit
<dd><a name=index1329>A</a> transit AS has connections to more than one other
AS and will carry transit traffic. The AS may impose policy restrictions on
what transit traffic will be carried.
</dl>
<dt>
AS number
<dd>A 16-bit number uniquely identifying an AS. This is the same AS number used
by GGP and EGP.
<dt>
AS path
<dd><a name=index1331>A</a> list of all of the AS numbers traversed by a route
when exchanging routing information. Rather than exchanging simple metric
counts, BGP-3  communicates entire paths to its neighbors.
<dt>
Routing Policy
<dd>A set of rules constraining routing to conform to the wishes of the
authority which administers the AS. Routing policies are not defined in the
BGP-3 protocol, but are selected by the AS authority and presented to BGP-3 in
the form of implementation-specific configuration data. Routing policies may be
selected by the AS authority in whatever way that authority sees fit. For
example:
<ul>
<li>A multihomed AS can refuse to act as a transit AS. It does this by not
advertising routes to networks other than those directly connected to it.
<li>A multihomed AS can limit itself to being a transit AS for a restricted set
of adjacent ASs.  It does this by advertising its routing information to this
set only.
<li>An AS can select which outbound AS should be used for carrying transit
traffic.
An AS can also apply performance-related criteria when selecting outbound
paths:
<li>An AS can optimize traffic to use short AS paths rather than long ones.
<li>An AS can select transit routes according to the service quality of the
intermediate hops. This service quality information could be obtained using
mechanisms external to BGP-3.
</ul>
</dl>
<p>It can be seen from the definitions above that a stub AS or a multihomed AS
has the same topological properties as an AS in the ARPANET architecture: that
is it never acts as an intermediate AS in an inter-AS route. In the ARPANET
architecture, EGP was sufficient for such an AS to exchange reachability
information with its neighbors, and this remains true with BGP-3. Therefore, a
stub AS or a multihomed AS may continue to use EGP (or any other suitable
protocol) to operate with a transit AS. However, RFC 1268 recommends that BGP-3
is used instead of EGP for these types of AS because it provides an advantage
in bandwidth and performance. Additionally, in a multihomed AS, BGP-3 is more
likely to provide an optimum inter-AS route than EGP, since EGP only addresses
reachability and not ``distance''.

<h5><a name="H379">Path Selection</a>
</h5>
<p><a name=index1332>Each</a> BGP speaker must evaluate different paths to a
destination from the border router(s) for an AS connection, select the best one
that complies with the routing policies in force and then advertise that route
to all of its BGP neighbors at that AS connection.
<p>BGP-3 is a vector-distance protocol <a name=index1333>but,</a> unlike
traditional vector-distance protocols such as RIP where there is a single
metric, BGP-3 determines a preference order by applying a function mapping each
path to a preference value and selects the path with the highest value. The
function applied is generated by the BGP-3 implementation according to
configuration information.
<p>Where there are multiple viable paths to a destination, BGP-3 maintains all
of them but only advertises the one with the highest preference value. This
approach allows a quick change to an alternate path should the primary path
fail.

<h5><a name="H380">Routing Policies</a>
</h5>
<p>RFC 1268 includes a recommended set of policies for all implementations:
<ul>
<li>A BGP-3 implementation should be able to control which routes it announces.
The granularity of this control should be at least at the network level for the
announced routes and at the AS level for the recipients. For example, BGP-3
should allow a policy of announcing a route to a specific network to a specific
adjacent AS.
<li>BGP-3 should allow a weighting policy for paths. Each AS can be assigned a
weight and the preferred path to a destination is then the one with the lowest
aggregate weight.
<li>BGP-3 should allow a policy of excluding an AS from all possible paths.
This can be done with a variant of the previous policy; each AS to be excluded
is given an ``infinite'' weight and the route selection process refuses to
consider paths of infinite weight.
</ul>

<h5><a name="H381">AS Consistency</a>
</h5>
<p>BGP-3 requires that a transit AS present the same view to every AS using its
services. If the AS has multiple BGP speakers, they must agree on two aspects
of topology: intra-AS and inter-AS. Since BGP-3 does not deal with intra-AS
routing at all, a consistent view of intra-AS topology must be provided by the
interior routing protocol(s) employed in the AS. Naturally, a protocol such as
OSPF (see <a href="3376c33.html#ospf">Open Shortest Path First Protocol (OSPF)
Version 2</a>) or Integrated IS-IS (see <a href="3376c33.html#isis">OSI
Intermediate System to Intermediate System (IS-IS)</a>) which implements
synchronization of router databases lends itself well to this role. Consistency
of the external topology <i>may</i> be provided by all BGP speakers in the AS
having BGP sessions with each other, but BGP-3 does not require that this
method be used, only that consistency be maintained.

<h5><a name="H382">Routing Information Exchange</a>
</h5>
<p>BGP-3 only advertises routes that it uses itself to its neighbors. That is,
BGP-3 conforms to the normal Internet hop-by-hop paradigm, even though it has
additional information in the form of AS paths and theoretically could be
capable of informing a neighbor of a route it would not use itself.
<p>When two BGP speakers form a BGP session, they begin by exchanging their
entire routing tables. Routing information is exchanged via UPDATE messages
(see below for the format of these messages). Since the routing information
contains the complete AS path to each listed destination in the form of a list
of AS numbers in addition to the usual reachability and next hop information
used in traditional vector distance protocols, it can be used to suppress
routing loops and to eliminate the <i>counting-to-infinity</i> problem found in
RIP. After BGP neighbors have performed their initial exchange of their
complete routing databases, they only <a name=index1334>exchange</a> updates to
that information.

<h5><a name="H383">BGP-3 Message formats</a>
</h5>
<p>All BGP-3 messages have a common basic format. They vary between 19 and 4096
bytes in length, are transmitted over TCP and are processed in their entirety
(that is, a BGP speaker does not begin to process the message until it has
received the whole message). Each message has a header shown in
<a href="3376c34.html#figbgphdr">Figure - BGP-3 Header</a>.
<br><br><a name=figbgphdr>
<img src="3376f91.gif"></a>
<br><i>Figure: BGP-3 Header</i><br><br>
<dl>
<dt>
Marker
<dd>A value which can be predicted by the receiver, used for authentication and
for identifying loss of synchronization. It is set to ``all ones'' when the
Authentication Code is 0 (see below).
<dt>
Length
<dd>Total length of the message including the header, in bytes.  The message
must not be padded since the length is used to calculate the length of the last
field of the message in many cases.
<dt>
type
<dd>An 8-bit unsigned value.
<dl>
<dt>
1
<dd>OPEN <a href=3376footnotes.html#footnote10>(10)</a>
<dt>
2
<dd>UPDATE
<dt>
3
<dd>NOTIFICATION
<dt>
4
<dd>KEEPALIVE
</dl>
</dl>
<p>OPEN messages are used to initiate the BGP-3 session.  The format of an OPEN
message is shown in <a href="3376c34.html#figbgpopen">Figure - BGP-3 OPEN
Message</a>.
<br><br><a name=figbgpopen>
<img src="3376f92.gif"></a>
<br><i>Figure: BGP-3 OPEN Message</i><br><br>
<dl>
<dt>
Version
<dd>3 for BGP-3 (1 byte)
<dt>
My Autonomous System
<dd>The AS number of the sender (2 bytes)
<dt>
Hold time
<dd>The maximum length of time in seconds that may elapse between the receipt
of successive KEEPALIVE and/or UPDATE and/or NOTIFICATION messages (2 bytes).
<dt>
BGP Identifier
<dd>A unique 32-bit number identifying the BGP speaker. It is the IP address of
any one of the speaker's interfaces. The same number is used for all interfaces
and all BGP neighbors.
<dt>
Authentication Code
<dd>Defines the interpretation of the Authentication Data (1 byte). BGP-3
defines no authentication codes other than zero (for no authentication).
<dt>
Authentication Data
<dd>Dependent on the Authentication Code.  The length is variable and is
inferred from the message length. For authentication code zero, the data is
omitted (it has a length of zero).
</dl>
<p>UPDATE messages are used to transfer routing information. The format of an
UPDATE message is shown in <a href="3376c34.html#figbgpupdt">Figure - BGP-3
UPDATE Message</a>.
<br><br><a name=figbgpupdt>
<img src="3376f93.gif"></a>
<br><i>Figure: BGP-3 UPDATE Message</i><br><br>
<dl>
<dt>
Attributes Length
<dd>Length of the path attributes field in bytes (2 bytes).
<dt>
Path Attributes
<dd>Each path attribute is a triple: &lt;<i>attribute type, attribute length,
attribute value</i>&gt; where:
<dl>
<dt>
attribute type
<dd>is a 2-byte field, consisting of an attribute flag byte and a 1-byte
<i>attribute type code</i>. The bits in the flag byte are:
<dl>
<dt>
X'80'
<dd>Optional attribute. If set, the attribute is <i>optional</i>, otherwise it
is <i>well-known</i>. Well-known attributes are those that all BGP-3
implementations must handle. There are two types: <i>mandatory</i> attributes
must be included in every UPDATE message, <i>discretionary</i> attributes may
be omitted from UPDATE messages.
<p>Optional attributes are those that BGP-3 implementations are not required to
recognize. If a receiving BGP speaker does not recognize the attribute, it
should handle it according to the transitive bit. BGP speakers are allowed to
make appropriate updates to attributes in messages which they receive from
peers before relaying them to other BGP speakers.
<dt>
X'40'
<dd>Transitive attribute. This bit must be set if the attribute is mandatory.
For optional attributes, if this bit is set, the attribute is
<i>transitive</i>, otherwise it is <i>non-transitive</i>. An unrecognized
transitive optional attribute must be passed on to other BGP peers after
setting the partial bit. An unrecognized non-transitive optional attribute must
be quietly discarded. BGP speakers may add transitive optional attributes to
the path attributes in an UPDATE message before relaying it to a peer.
<dt>
X'20'
<dd>Partial attribute. This bit indicates that a transitive optional attribute
was passed on by a BGP speaker that did not recognize it or was added by a BGP
speaker other than the originator of the message. In all other cases it must be
zero.
<dt>
X'10'
<dd>Extended length. The attribute length field is two bytes if this bit is set
and one byte if not.
The low order four bits must be zero and must be ignored by the recipient.
</dl>
Refer to RFC 1267 for more details of how these bits are interpreted.
<p>The attribute type codes defined are shown in
<a href="3376c34.html#tabbgp3typ">Table - BGP-3 UPDATE Path Attribute Type
Values</a>.   <br><br>
<a name=tabbgp3typ><img src=3376t9.gif></a><br>
<i>Table: BGP-3 UPDATE Path Attribute Type Values</i><br><br>
<dl>
<dt>
ORIGIN
<dd>The method by which this path was learned by the originating AS.
<dl>
<dt>
0
<dd>IGP -- the networks listed are within the originating AS.
<dt>
1
<dd>EGP -- the networks listed are outside the originating AS and the
reachability information was learned from EGP.
<dt>
2
<dd>INCOMPLETE -- the networks listed were learned by some other means.
</dl>
<dt>
AS_PATH
<dd>The 2-byte AS numbers of each AS in the path to the destination network(s).
The number of hops in the path can be calculated by dividing the attribute
length by 2.
<dt>
NEXT_HOP
<dd>The IP address of the border router that is the next hop on the path to the
listed network(s). This field is ignored for internal BGP connections.
<dt>
UNREACHABLE
<dd>Previously advertised routes have now become unreachable.
<dt>
INTER-AS METRIC
<dd>This value may be used to choose between multiple paths to one AS. If all
other factors are equal, the path with the lower metric is to be preferred.
This value may be sent to a BGP speaker in a neighboring AS, and if received
over an external BGP connection, it may be propagated over internal BGP
connections. A BGP speaker may not relay an INTER-AS METRIC in an UPDATE
message which it receives from a peer to an external peer.
</dl>
<dt>
attribute length
<dd>One or two byte length (depending on the value of the extended length bit).
<dt>
attribute value
<dd>Dependent upon the value of the attribute type code.
</dl>
Each attribute can be specified only once. The end of the attributes is
determined from the path attributes length field.
<dt>
Network 1
<dd>The 32-bit network number of the first network described by the preceding
path attributes. Subnets and hosts are explicitly disallowed.
<dt>
Network n
<dd>The network number of the last network described by the preceding path
attributes. The number of networks can be calculated by subtracting the lengths
of the BGP-3 header and the path attributes information from the length of the
message and dividing by 4.
</dl>
<p>NOTIFICATION messages are used to inform the neighbor of an error. The BGP
connection is terminated after the message is sent.  The format of a
NOTIFICATION message is shown in
<a href="3376c34.html#figbgpnot">Figure - BGP-3 NOTIFICATION Message</a>.
<br><br><a name=figbgpnot>
<img src="3376f94.gif"></a>
<br><i>Figure: BGP-3 NOTIFICATION Message</i><br><br>
<dl>
<dt>
Code
<dd>One byte indicating the type of error. The following codes are defined:
<dl>
<dt>
1
<dd>Message Header Error
<dt>
2
<dd>OPEN Message Error
<dt>
3
<dd>UPDATE Message Error
<dt>
4
<dd>Hold Timer Expired
<dt>
5
<dd>Finite State Machine Error
<dt>
6
<dd>Cease
</dl>
<dt>
Subcode
<dd>A single byte providing more information about the nature of the error. The
value 0 (unspecific) indicates that no more appropriate subcode exists. In
addition the following subcodes are defined:
<dl>
<b><dt></b>
Message Header Error Subcodes
<dt>
1
<dd>Connection Not Synchronized
<dt>
2
<dd>Bad Message Length
<dt>
3
<dd>Bad Message Type
</dl>
<dl>
<b><dt></b>
OPEN Message Error Subcodes
<dt>
1
<dd>Unsupported Version Number
<dt>
2
<dd>Bad Peer AS
<dt>
3
<dd>Bad BGP Identifier
<dt>
4
<dd>Unsupported Authentication Code
<dt>
5
<dd>Authentication Failure
</dl>
<dl>
<b><dt></b>
UPDATE Message Error Subcodes
<dt>
1
<dd>Malformed Attribute List
<dt>
2
<dd>Unrecognized Well-known Attribute
<dt>
3
<dd>Missing Well-known Attribute
<dt>
4
<dd>Attribute Flags Error
<dt>
5
<dd>Attribute Length Error
<dt>
6
<dd>Invalid ORIGIN Attribute
<dt>
7
<dd>AS Routing Loop
<dt>
8
<dd>Invalid NEXT_HOP Attribute
<dt>
9
<dd>Optional Attribute Error
<dt>
10
<dd>Invalid Network Field
</dl>
<dt>
Data
<dd>Variable length information dependent upon the code and subcode which can
be used to diagnose the cause of the error.  The length can be calculated by
subtracting 21 from the total message length.
<p>KEEPALIVE messages are used to ensure that the connection is still working.
The KEEPALIVE message consists of just the header.
</dl>

<h5><a name="H390">References</a>
</h5>
<p>A detailed description of BGP-3 may be found in the following RFCs:
<ul>
<li><i>RFC 1265 - BGP Protocol Analysis</i>
<li><i>RFC 1266 - Experience with the BGP protocol</i>
<li><i>RFC 1267 - A Border Gateway Protocol 3 (BGP-3)</i>
<li><i>RFC 1268 - Application of the Border Gateway Protocol in the
Internet</i>
</ul>

<h4><a name="bgpospf">3.4.2.2  BGP OSPF Interaction</a>
</h4>
<p><a name=index1341>There</a> is a <i>proposed standard protocol</i> with a
status of <i>elective</i> defining how BGP-3 (an exterior routing protocol)
should interact with OSPF (an interior routing protocol). Any host or router
which dynamically exchanges information between BGP-3 and OSPF should adhere to
this standard. <a name=index1342>It</a> is described in <i>RFC 1654 - BGP OSPF
Interaction</i>.
<p>BGP OSPF interaction covers the conversion from OSPF fields in an External
Links Advertisement to BGP path attributes, and vice versa, for three
properties of a route definition.   <br><br>
<a name=tabbgpospf><img src=3376t10.gif></a><br>
<i>Table: BGP OSPF Attribute-Field Mapping</i><br><br>
<p>The standard defines how these mappings should be done and what restrictions
there are on what may be done automatically. Please refer to the RFC for more
information.

<h4><a name="bgp4">3.4.2.3  Border Gateway Protocol Version 4 (BGP-4)</a>
</h4>
<p><a name=index1343>BGP-4</a> is a <i>proposed standard protocol</i>. Its
status is <i>elective</i>. <a name=index1344>It</a> is described in RFC 1654.
The main changes are to support <i>supernetting</i> or <i>Classless
Inter-Domain Routing (CIDR) </i> <a name=index1345>which</a> is described in
<a href="3376c22.html#cidr">Classless Inter-Domain Routing (CIDR)</a>. In
particular BGP-4 supports <a name=index1347>IP</a> prefixes and path
aggregation. Because CIDR is radically different from the normal Internet
routing architecture, BGP-4 is incompatible with BGP-3. However, BGP does
define a mechanism for two BGP speakers to negotiate a version which they both
understand. This is done using the OPEN message. Therefore, it is possible to
implement ``multi-lingual'' BGP speakers which will allow inter-operation of
BGP-3 and BGP-4.
<p>The following items identify the major changes between BGP-3 and BGP-4.
<ul>
<li>The BGP Version Number in the header field is 4.
<li>CIDR removes the concept of a network class from inter-domain routing,
replacing it with the concept of an IP prefix.
<li>The list of networks in an UPDATE message is replaced by <i>network layer
reachability information (NLRI)</i><a name=index1349>.</a>
<li>BGP-4 introduces the aggregation of multiple routes or AS paths into single
entries or <i>aggregates</i><a name=index1351>.</a> The use of aggregates can
dramatically reduce the amount of routing information required.
<p>A new attribute for an AS path (ATOMIC_AGGREGATE) can be used to insure that
certain aggregates are not de-aggregated. Another new attribute (AGGREGATOR)
can be added to aggregate routes in order to advertise which AS and which BGP
speaker within that AS caused the aggregation.
<li>BGP-4 conceptually models the data held by a BGP speaker into three sets of
<i>Routing Information Bases (RIB)</i>: <a name=index1352>one</a> set
(Adj-RIBs-In) for data obtained from BGP neighbors; one RIB (Loc-RIB) for local
data obtained by the operation of the local routing policies on the
Adj-RIBs-In; and one set (Adj-RIBs-Out) for data that is to be advertised in
update messages.
<li>BGP-4 allows negotiation of Hold Times on a per-connection basis so that
both ends of a connection are using the same value.
<li>BGP-4 changes the format of the UPDATE message to that shown in
<a href="3376c34.html#figbgp4upd">Figure - BGP UPDATE Message</a>.
<br><br><a name=figbgp4upd>
<img src="3376f95.gif"></a>
<br><i>Figure: BGP UPDATE Message</i><br><br>
<dl>
<dt>
Unfeasible Length
<dd>This is a contraction of <i>Unfeasible Routes Length</i> and is a 2-byte
field giving the length of the Withdrawn Routes data. It may be zero,
indicating no withdrawn routes.
<dt>
Withdrawn Routes
<dd>A list of IP address prefixes that are being withdrawn from service. Each
entry is of the form <i>&lt;length, prefix&gt;</i> where <i>length</i> is a
single byte giving the length of the prefix in bits, and prefix is the IP
address prefix padded to the next byte boundary. A length of zero matches all
IP addresses.
<dt>
Attributes Length
<dd>A 2-byte field giving the length of the path attributes field in bytes.
<dt>
Path Attributes
<dd>These have the same values as for BGP-3 except as noted here:
<dl>
<dt>
attribute type
<dd>The following attribute type codes are defined:   <br><br>
<a name=unnamed><img src=3376t11.gif></a><br>
<br><br>
<dl>
<dt>
ORIGIN
<dd>The method by which this path was learned by the originating AS.
<dl>
<dt>
0
<dd>IGP - the networks listed are within the originating AS.
<dt>
1
<dd>EGP - the networks listed are outside the originating AS and the
reachability information was learned from EGP.
<dt>
2
<dd>INCOMPLETE -- the networks listed were learned by some other means.
</dl>
<dt>
AS_PATH
<dd><a name=index1353>A</a> sequence of <i>AS Path segments</i>. Each of these
is of the form <i>&lt;path segment type, path segment length,
path segment value&gt;</i>
<dl>
<dt>
path segment type
<dd>A 1-byte value indicating how the path segment is to be interpreted.
<dl>
<dt>
1
<dd>AS_SET: an unordered set of those ASs that a route in the UPDATE message
has traversed
<dt>
2
<dd>AS_SEQUENCE: an ordered set of ASs that a route in the UPDATE message has
traversed
</dl>
<dt>
path segment length
<dd>A 1-byte value containing the number of ASs in the path segment field.
<dt>
path segment length
<dd>A series of 2-byte AS numbers.
</dl>
<dt>
NEXT_HOP
<dd>The IP address of the border router that is the next hop on the path to the
listed destination(s).
<dt>
MULTI_EXIT_DISC
<dd>This value may be used to choose between multiple paths to one AS. It
replaces the BGP-3 INTER-AS METRIC. If all other factors are equal, the path
with the lower value is to be preferred. This value may be sent to a BGP
speaker in a neighboring AS, and if received over an external BGP connection,
it may be propagated over internal BGP connections. A BGP speaker may not relay
a MULTI_EXIT_DISC value in an UPDATE message which it receives from a peer to
an external peer.
<dt>
LOCAL_PREF
<dd>Used by a BGP speaker to inform other BGP speakers in its own AS of its
degree of preference for an advertised route.
<dt>
ATOMIC_AGGREGATE
<dd>Used by a BGP speaker to inform other BGP speakers that the local system
selected a less specific route without selecting a more specific route which is
included in it.
<dt>
AGGREGATOR
<dd>The 2-byte AS number of the last AS number that formed the aggregate route
followed by the IP address of the BGP speaker that formed the aggregate route.
</dl>
<dt>
attribute length
<dd>One or two byte length (depending on the value of the extended length bit).
<dt>
attribute value
<dd>Dependent upon the value of the attribute type code.
</dl>
Each attribute can be specified only once. The end of the attributes is
determined from the path attributes length field.
<dt>
Network Reachability Information
<dd>A series of IP prefixes described by the preceding path attributes. The end
of the data can be determined by reference to the length of the message. Each
entry is of the form <i>&lt;length, prefix&gt;</i> where <i>length</i> is a
single byte giving the length of the prefix in bits, and prefix is the IP
address prefix padded to the next byte boundary. A length of zero matches all
IP addresses.
</dl>
<li>The following error subcodes are added to the NOTIFICATION message
definition:
<dl>
<b><dt></b>
OPEN Message Error Subcodes
<dt>
6
<dd>Unacceptable Hold Time
</dl>
<dl>
<b><dt></b>
UPDATE Message Error Subcodes
<dt>
11
<dd>Malformed AS_PATH
</dl>
<li>BGP-4 defines the following rules for creating AS_PATHs or modifying
AS_PATHs learned from a BGP neighbor.
<ul>
The following two rules describe how to create a new AS_PATH:
<li>When advertising it to a BGP speaker in the same AS, an AS-PATH of zero
length is created.
<li>When advertising it to a BGP speaker in a different AS, the AS_PATH
includes only the sender's AS number.
The following two rules describe how to handle AS_PATHs learned from a
neighbor:
<li>When advertising it to a BGP speaker in the same AS, the AS-PATH is left
unchanged.
<li>When advertising it to a BGP speaker in the same AS, the advertising BGP
adds its own AS number to the beginning the AS-PATH. If the AS_PATH begins with
a segment which is an AS_SEQUENCE, it adds its AS number to the beginning of
that sequence, but if it begins with an AS-SET, the advertising BGP adds a new
segment of the AS_SEQUENCE type to the beginning of the AS_PATH.
</ul>
</ul>

<h5><a name="H396">References</a>
</h5>
<p>A detailed description of BGP-4 can be found in the following RFCs:
<ul>
<li><i>RFC 1654 - A Border Gateway Protocol 4 (BGP-4)</i>
<li><i>RFC 1655 - Application of the Border Gateway Protocol in the
Internet</i>
<li><i>RFC 1656 - BGP-4 Protocol Document Roadmap and Implementation
Experience</i>
</ul>

<h3><a name="ibmrtr">3.4.3  IP Routing Protocols in IBM TCP/IP Products</a>
</h3>
<p><a name=index1362>The</a> <i>routed</i> program which supports RIP is
implemented on the following IBM TCP/IP platforms:
<menu>
<li>MVS
<li>VM
<li>AIX
<li>OS/2
<li>DOS
</menu>
The routed program is not implemented on OS/400.
<p>The <i>gated</i> <a name=index1367>program</a> which supports RIP, Hello,
EGP and BGP is implemented on AIX. <a name=index1369>On</a> AIX 4.1, gated
additionally supports OSPF Version 2 and RIP Version 2.
<p>The IBM 6611 Network Processor <a name=index1376>implements</a> RIP, RIP
Version 2, Hello, OSPF, EGP and BGP.
<p>The IBM 2210 Nways Network Processor <a name=index1380>implements</a> RIP,
OSPF and EGP.

<p><a href="./3376fm.html"><img src="fm2html-toc.gif">Table of Contents</a>  <a href="3376ch4.html#applic"><img src="fm2html-next.gif">Application
Protocols</a><br>
</html>
