<!-- output file generated by BM Utilities -->
<html>

<p><a href="./3376fm.html"><img src="fm2html-toc.gif">Table of Contents</a>  <a href="3376c23.html#H127"><img src="fm2html-previous.gif">IP
Routing Algorithm</a><br>
<head>
<title>
TCP/IP Tutorial and Technical Overview
</title>
<body>

<h2><a name="icmp">2.4  Internet Control Message Protocol (ICMP)</a>
</h2>
<br><br><a name=fig>
<img src="3376icmp.gif"></a>
<br><i>Figure: Internet Control Message Protocol (ICMP)</i><br><br>
<p><a name=index805>ICMP</a> is a <i>standard protocol</i> with STD number 5
which also includes IP (see <a href="3376c23.html#ip">Internet Protocol
(IP)</a>) and IGMP (see <a href="3376c27.html#igmp">Internet Group Management
Protocol (IGMP)</a>). <a name=index806>Its</a> status is <i>required</i>. It is
described in RFC 792 with updates in RFC 950.  It is part of STD 5 which also
includes IP (see <a href="3376c23.html#ip">Internet Protocol (IP)</a>).
<p><a name=index809>Path</a> MTU Discovery is a <i>draft standard protocol</i>
with a status of <i>elective</i>. <a name=index811>It</a> is described in RFC
1191.
<p><a name=index812>ICMP</a> Router Discovery is a <i>proposed standard
protocol</i> with a status of <i>elective</i>. <a name=index814>It</a> is
described in RFC 1256.
<p><a name=index815>When</a> a router or a destination host must inform the
source host about errors in datagram processing, it uses the Internet Control
Message Protocol (ICMP). ICMP can be characterized as follows:
<ul>
<li>ICMP uses IP as if ICMP were a higher-level protocol (that is, ICMP
messages are encapsulated in IP datagrams). However, ICMP is an integral part
of IP and must be implemented by every IP module.
<li>ICMP is used to report some errors, <i>not</i> to make IP reliable.
Datagrams may still be undelivered without any report on their loss.
Reliability must be implemented by the higher-level protocols that use IP.
<li>ICMP can report errors on any IP datagram with the exception of ICMP
messages, to avoid infinite repetitions.
<li>For fragmented IP datagrams, ICMP messages are only sent about errors on
fragment zero. That is, ICMP messages never refer to an IP datagram with a
non-zero fragment offset field.
<li>ICMP messages are never sent in response to datagrams with a destination IP
address that is a broadcast or a multicast address.
<li>ICMP messages are never sent in response to a datagram which does not have
a source IP address which represents a unique host. That is, the source address
cannot be zero, a loopback address, a broadcast address or a multicast address.
<li>ICMP messages are never sent in response to ICMP error messages. They may
be sent in response to ICMP query messages (ICMP types 0, 8, 9, 10 and 13
through 18).
<li>RFC 792 states that ICMP messages ``may'' be generated to report IP
datagram processing errors, <i>not</i> ``must''. In practice, routers will
almost always generate ICMP messages for errors, but for destination hosts, the
number of ICMP messages generated is implementation dependent.
</ul>

<h3><a name="icmpmsg">2.4.1  ICMP Messages</a>
</h3>
<p><a name=index816>ICMP</a> messages are described in RFC 792 and RFC 950,
belong to STD 5 and are mandatory.
<p>ICMP messages are sent in IP datagrams. The IP header will always have a
Protocol number of 1, indicating ICMP and a type of service of zero (routine).
The IP data field will contain the actual ICMP message in the format shown in
<a href="3376c24.html#figicmpfmt">Figure - ICMP Message Format</a>.
<br><br><a name=figicmpfmt>
<img src="3376f23.gif"></a>
<br><i>Figure: ICMP Message Format</i><br><br>
<a name=index817>Where</a>:
<dl>
<dt>
Type
<dd>Specifies the type of the message:
<dl>
<dt>
0
<dd>Echo reply
<dt>
3
<dd>Destination unreachable
<dt>
4
<dd>Source quench
<dt>
5
<dd>Redirect
<dt>
8
<dd>Echo
<dt>
9
<dd>Router advertisement
<dt>
10
<dd>Router solicitation
<dt>
11
<dd>Time exceeded
<dt>
12
<dd>Parameter problem
<dt>
13
<dd>Timestamp request
<dt>
14
<dd>Timestamp reply
<dt>
15
<dd>Information request (obsolete)
<dt>
16
<dd>Information reply (obsolete)
<dt>
17
<dd>Address mask request
<dt>
18
<dd>Address mask reply
</dl>
<dt>
Code
<dd>Contains the error code for the datagram reported on by this ICMP message.
The interpretation is dependent upon the message type.
<dt>
Checksum
<dd><a name=index819>Contains</a> the 16-bit one's complement of the one's
complement sum of the ICMP message starting with the ICMP Type field. For
computing this checksum, the checksum field is assumed to be zero. This
algorithm is the same as that used by IP for the IP header. Compare this with
the algorithm used by UDP and TCP (see <a href="3376c211.html#udpf1">User
Datagram Protocol (UDP)</a> and <a href="3376c212.html#tcp">Transmission
Control Protocol (TCP)</a>) which also include a <i>pseudo-IP</i> header in the
checksum.
<dt>
Data
<dd>Contains information for this ICMP message. Typically it will contain a
part of the original IP message for which this ICMP message was generated. The
length of the data can be determined from the length of the IP datagram that
contains the message less the IP header length.
</dl>
<p>Each of the messages is explained below.

<h4><a name="icmp0">2.4.1.1  Echo Reply (0)</a>
</h4>
<p>See <a href="3376c24.html#icmp8">Echo (8) and Echo Reply (0)</a>.

<h4><a name="icmp3">2.4.1.2  Destination Unreachable (3)</a>
</h4>
<br><br><a name=figicmp3>
<img src="3376f24.gif"></a>
<br><i>Figure: ICMP Destination Unreachable</i><br><br>
<p><a name=index820>If</a> this message is received from an intermediate
router, it means that the router regards the destination IP address as
unreachable.
<p>If this message is received from the destination host, it means that the
protocol specified in the protocol number field of the original datagram is not
active, or that protocol is not active on this host or if the specified port is
inactive (see <a href="3376c211.html#udpf1">User Datagram Protocol (UDP)</a>
for an introduction to the port concept).
<p>The ICMP header code field will have one of the following values:
<dl>
<dt>
0
<dd>network unreachable
<dt>
1
<dd>host unreachable
<dt>
2
<dd>protocol unreachable
<dt>
3
<dd>port unreachable
<dt>
4
<dd>fragmentation needed but the <i>Do Not Fragment</i> bit was set
<dt>
5
<dd>source route failed
<dt>
6
<dd>destination network unknown
<dt>
7
<dd>destination host unknown
<dt>
8
<dd>source host isolated (obsolete)
<dt>
9
<dd>destination network administratively prohibited
<dt>
10
<dd>destination host administratively prohibited
<dt>
11
<dd>network unreachable for this type of service
<dt>
12
<dd>host unreachable for this type of service
<dt>
13
<dd>communication administratively prohibited by filtering
<dt>
14
<dd>host precedence violation
<dt>
15
<dd>precedence cutoff in effect
</dl>
<p>If a router implements the Path MTU Discovery protocol, the format of the
Destination unreachable message is changed for code 4 to include the MTU of the
link which could not accept the datagram.
<br><br><a name=figicmp34>
<img src="3376f25.gif"></a>
<br><i>Figure: ICMP Fragmentation Required with Link MTU</i><br><br>

<h4><a name="icmp4">2.4.1.3  Source Quench (4)</a>
</h4>
<br><br><a name=fig>
<img src="3376f26.gif"></a>
<br><i>Figure: ICMP Source Quench</i><br><br>
<p><a name=index821>If</a> this message is received from an intermediate
router, it means that the router does not have the buffer space needed to queue
the datagrams for output to the next network.
<p>If this message is received from the destination host, it means that the
incoming datagrams are arriving too quickly to be processed.
<p>The ICMP header code field is always zero.

<h4><a name="icmp5">2.4.1.4  Redirect (5)</a>
</h4>
<br><br><a name=figicmp5>
<img src="3376f27.gif"></a>
<br><i>Figure: ICMP Redirect</i><br><br>
<p><a name=index822>If</a> this message is received from an intermediate
router, it means that the host should send future datagrams for the network to
the router whose IP address is given in the ICMP message. This preferred router
will always be on the same subnet as the host which sent the datagram and the
router which returned the IP datagram. The router will forward the datagram to
its next hop destination. If the router IP address matches the source IP
address in the original datagram header it indicates a routing loop.  This ICMP
will not be sent if the IP datagram contains a source route.
<p>The ICMP header code field will have one of the following values:
<dl>
<dt>
0
<dd>Network redirect
<dt>
1
<dd>Host redirect
<dt>
2
<dd>Network redirect for this type of service
<dt>
3
<dd>Host redirect for this type of service
</dl>

<h4><a name="icmp8">2.4.1.5  Echo (8) and Echo Reply (0)</a>
</h4>
<br><br><a name=figicmp8>
<img src="3376f28.gif"></a>
<br><i>Figure: ICMP Echo and Echo Reply</i><br><br>
<p><a name=index824>Echo</a> is used to detect if another host is active on the
network. The sender initializes the identifier and sequence number (which is
used if multiple echo requests are sent), adds some data to the data field and
sends the ICMP echo to the destination host. The ICMP header code field is
zero. The recipient changes the type to Echo Reply and returns the datagram to
the sender. This mechanism is used by the Ping command to determine if a
destination host is reachable (see <a href="3376c25.html#ping">Ping</a>).

<h4><a name="icmp9">2.4.1.6  Router Advertisement (9) and Router Solicitation
(10)</a>
</h4>
<p>ICMP messages 9 and 10 are optional.  They are described in RFC 1256 which
is elective.
<p>
<br><br><a name=figicmp9>
<img src="3376f29.gif"></a>
<br><i>Figure: ICMP Router Advertisement</i><br><br>
<br><br><a name=figicmp10>
<img src="3376f30.gif"></a>
<br><i>Figure: ICMP Router Solicitation</i><br><br>
<dl>
<dt>
<a name=index826>number</a>
<dd>The number of entries in the message.
<dt>
entry length
<dd>The length of an entry in 32-bit units. This is 2 (32 bits for the IP
address and 32 bits for the preference value).
<dt>
TTL
<dd>The number of seconds that an entry will can be considered valid.
<dt>
router address
<dd>One of the sender's IP addresses.
<dt>
preference level
<dd>A signed 32-bit level indicating the preference to be assigned to this
address when selecting a default router for a subnet. Each router on a subnet
is responsible for advertising its own preference level. Larger values imply
higher preference, smaller values imply lower. The default is zero, which is in
the middle of the possible range. A value of X'80000000' -2(superscript 31)
indicates that the router should never be used as a default router.
</dl>
<p>The ICMP header code field is zero for both of these messages.
<p>These two messages are used if a host or a router supports the Router
Discovery Protocol. The use of multicasting is recommended, but broadcasting
may be used if multicasting is not supported on an interface. Routers
periodically advertise their IP addresses on those subnets where they are
configured to do so. Advertisements are made on the all-systems multicast
address (224.0.0.1) or the limited broadcast address (255.255.255.255). The
default behavior is to send advertisements every 10 minutes with a TTL value of
1800 (30 minutes). Routers also reply to solicitation messages they receive.
They may reply directly to the soliciting host, or they may wait a short random
interval and reply with a multicast. Hosts may send solicitation messages when
they start until they receive a response. Solicitation messages are sent to the
all-routers multicast address (224.0.0.2) or the limited broadcast address
(255.255.255.255). Typically, three solicitation messages are sent at 3-second
intervals. Alternatively a host may wait for periodic advertisements. Each time
a host receives an advertisement, it updates its default router if the new
advertisement has one with a higher preference value and sets the TTL timer for
the entry to match the value in the advertisement. When the host receives a new
advertisement for its current default router, it resets the TTL value to that
in the new advertisement. This also provides a mechanism for routers to declare
themselves unavailable: they send an advertisement with a TTL value of zero.

<h4><a name="icmp11">2.4.1.7  Time Exceeded (11)</a>
</h4>
<br><br><a name=figicmp11>
<img src="3376f31.gif"></a>
<br><i>Figure: ICMP Time Exceeded</i><br><br>
<p><a name=index827>If</a> this message is received from an intermediate
router, it means that the time-to-live field of an IP datagram has expired.
<p>If this message is received from the destination host, it means that the IP
fragment reassembly time-to-live timer has expired while the host is waiting
for a fragment of the datagram. The ICMP header code field may have the one of
the following values:
<dl>
<dt>
0
<dd>transit TTL exceeded
<dt>
1
<dd>reassembly TTL exceeded
</dl>

<h4><a name="icmp12">2.4.1.8  Parameter Problem (12)</a>
</h4>
<br><br><a name=figicmp12>
<img src="3376f32.gif"></a>
<br><i>Figure: ICMP Parameter Problem</i><br><br>
<p><a name=index828>Indicates</a> that a problem was encountered during
processing of the IP header parameters. The pointer field points to the byte in
the original IP datagram where the problem was encountered. The ICMP header
code field may have the one of the following values:
<dl>
<dt>
0
<dd>unspecified error
<dt>
1
<dd>required option missing
</dl>

<h4><a name="icmp13">2.4.1.9  Timestamp Request (13) and Timestamp Reply
(14)</a>
</h4>
<br><br><a name=figicmp13>
<img src="3376f33.gif"></a>
<br><i>Figure: ICMP Timestamp Request and Timestamp Reply</i><br><br>
<p><a name=index830>These</a> two messages are for performance measurements and
for debugging. They are not used for clock synchronization: the Network Time
Protocol is used for that (see <a href="3376c422.html#time">Time and Daytime
Protocols</a>).
<p>The sender initializes the identifier and sequence number (which is used if
multiple timestamp requests are sent), sets the originate timestamp and sends
it to the recipient. The receiving host fills in the receive and transmit
timestamps, changes the type to Timestamp reply and returns it to the
recipient. The receiver has two timestamps in case there is a perceptible time
difference between the receipt and transmit times, but in practice, most
implementations will perform the two (receipt and reply) in one operation and
will set the two timestamps to the same value. Timestamps are the number of
milliseconds elapsed since midnight UT (GMT).

<h4><a name="icmp15">2.4.1.10  Information Request (15) and Information Reply
(16)</a>
</h4>
<br><br><a name=figicmp15>
<img src="3376f34.gif"></a>
<br><i>Figure: ICMP Information Request and Information Reply</i><br><br>
<p><a name=index832>An</a> Information Request is issued by a host to obtain an
IP address for an attached network. The sender fills in the request with the
destination IP address in the IP header set to zero (meaning this network) and
waits for a reply from a server authorized to assign IP addresses to other
hosts. The ICMP header code field is zero. The reply will contain IP network
addresses in both the source and destination fields of the IP header. This
mechanism is now obsolete. See also <a href="3376c29.html#rarp">Reverse Address
Resolution Protocol (RARP)</a>.

<h4><a name="icmp17">2.4.1.11  Address Mask Request (17) and Address Mask Reply
(18)</a>
</h4>
<br><br><a name=figicmp17>
<img src="3376f35.gif"></a>
<br><i>Figure: ICMP Address Mask Request and Reply</i><br><br>
<p><a name=index834>An</a> Address Mask Request is used by a host to determine
the subnet mask in use on an attached network. Most hosts will be configured
with their subnet mask(s), but some, such as diskless workstations, must obtain
this information from a server. A host uses RARP (see
<a href="3376c29.html#rarp">Reverse Address Resolution Protocol (RARP)</a>) to
obtain its IP address. To obtain a subnet mask, the host broadcasts an Address
Mask Request. Any host on the network which has been configured to send Address
Mask Replies will fill in the subnet mask, convert the packet to an Address
Mask Reply and return it to the sender. The ICMP header code field is zero.

<h3><a name="H156">2.4.2  ICMP Applications</a>
</h3>
<p>There are two simple and widely used applications which are based on ICMP:
Ping and Traceroute. Ping uses the ICMP Echo and Echo Reply messages to
determine whether a host is reachable. Traceroute sends IP datagrams with low
TTL values so that they expire en route to a destination. It uses the resulting
ICMP Time Exceeded messages to determine where in the internet the datagrams
expired and pieces together a view of the route to a host. These applications
are explained in <a href="3376c25.html#ping">Ping</a> and
<a href="3376c26.html#tracert">Traceroute</a>.

<h3><a name="icmpv6">2.4.3  ICMP for IP Version 6</a>
</h3>
<p><a name=index837>The</a> ICMP implementation above is specific to IP Version
4 (IPv4). IP Version 6 (IPv6, see <a href="3376c216.html#ipv6">IP Version 6
(IPv6)</a>) will require a new version of ICMP. The definitions of both new
versions of ICMP and IP are not yet complete.  Important features already known
are:
<ul>
<li>ICMP for IP Version 6 will use a new protocol number to distinguish it from
ICMP Version 4.
<li>The ICMP header format will remain the same.
<li>Field lengths in messages will change to accommodate longer IPv6 messages.
<li>The Type and code values will be changed. Certain little used values will
be removed.
<li>The size of ICMP messages will be increased to exploit the increased size
of packets which IPv6 guarantees will be transmitted without fragmentation.
<li>The Fragmentation Required variant of the ICMP Destination unreachable
message will be replaced by a Packet Too Big ICMP message which will include
the outgoing link Maximum Transmission Unit (MTU) where the problem is
identified.
<li>IGMP (see <a href="3376c27.html#igmp">Internet Group Management Protocol
(IGMP)</a>) will be merged with ICMP.
</ul>

<p><a href="./3376fm.html"><img src="fm2html-toc.gif">Table of Contents</a>  <a href="3376c25.html#ping"><img src="fm2html-next.gif">Ping</a><br>
</html>
