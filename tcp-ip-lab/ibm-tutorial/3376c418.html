<!-- output file generated by BM Utilities -->
<html>

<p><a href="./3376fm.html"><img src="fm2html-toc.gif">Table of Contents</a>  <a href="3376c417.html#H760"><img src="fm2html-previous.gif">DOS</a><br>
<head>
<title>
TCP/IP Tutorial and Technical Overview
</title>
<body>

<h2><a name="dhcp">4.18  Dynamic Host Configuration Protocol (DHCP)</a>
</h2>
<p><a name=index1913>DHCP</a> is a <i>proposed standard protocol</i>. Its
status is <i>elective</i>. The current DHCP specifications can be found in
<i>RFC  1541 - Dynamic Host Configuration Protocol</i> and <i>RFC 1533 - DHCP
Options and BOOTP Vendor Extensions</i>.
<p>The Dynamic Host Configuration Protocol (DHCP) provides a framework for
passing configuration information to hosts on a TCP/IP network. DHCP is based
on the BOOTP protocol, adding the capability of automatic allocation of
reusable network addresses and additional configuration options. For
information according to BOOTP please refer to
<a href="3376c417.html#bootp">BOOTstrap Protocol - BOOTP</a>. DHCP participants
can interoperate with BOOTP participants (RFC 1534).
<p>DHCP consists of two components:
<ol>
<li>A protocol that delivers host-specific configuration parameters from a DHCP
server to a host.
<li>A mechanism for the allocation of network addresses to hosts.
</ol>
<p>IP requires the setting of many parameters within the protocol
implementation software. Because IP can be used on many dissimilar kinds of
network hardware, values for those parameters cannot be guessed at or assumed
to have correct defaults. The use of a distributed address allocation scheme
based on a polling/defense mechanism, for discovery of network addresses
already in use, cannot guarantee unique network addresses because hosts may not
always be able to defend their network addresses.
<p>DHCP supports three mechanisms for IP address allocation:
<ol>
<li>Automatic allocation
<p>DHCP assigns a permanent IP address to the host.
<li>Dynamic allocation
<p>DHCP assigns an IP address for a limited period of time. Such a network
address is called a <i>lease</i>. This is the only mechanism that allows
automatic reuse of addresses that are no longer needed by the host to which it
was assigned.
<li>Manual allocation
<p>The host's address is assigned by a network administrator.
</ol>
The format of a DHCP message:
<br><br><a name=figdhcp>
<img src="3376f149.gif"></a>
<br><i>Figure: DHCP Message Format</i><br><br>
<dl>
<dt>
<a name=index1914>code</a>
<dd>Indicates  a request or a reply
<dl>
<dt>
1
<dd>Request
<dt>
2
<dd>Reply
</dl>
<dt>
HWtype
<dd>The type of hardware, for example:
<dl>
<dt>
1
<dd>Ethernet
<dt>
6
<dd>IEEE 802 Networks
</dl>
Refer to <i>STD 2 - Assigned Internet Numbers</i> for a complete list.
<dt>
length
<dd>Hardware address length in bytes. Ethernet and token-ring both use 6, for
example.
<dt>
hops
<dd>The client sets this to 0. It is incremented by a router which relays the
request to another server and is used to identify loops. RFC 951 suggests that
a value of 3 indicates a loop.
<dt>
Transaction ID
<dd>A random number used to match this boot request with the response it
generates.
<dt>
Seconds
<dd>Set by the client. It is the elapsed time in seconds since the client
started its boot process.
<dt>
Flags Field
<dd>The most significant bit of the flags field is used as a broadcast flag.
All other bits must be set to zero, and are reserved for future use. Normally,
DHCP servers attempt to deliver DHCP messages directly to a client using
unicast delivery. The destination address in the IP header is set to the DHCP
<i>your IP address</i> and the MAC address is set to the DHCP <i>client
hardware address</i>. If a host is unable to receive a unicast IP datagram
until it knows its IP address, then this broadcast bit must be set to indicate
to the server that the DHCP reply must be sent as an IP and MAC broadcast.
Otherwise this bit must be set to zero.
<dt>
Client IP address
<dd>Set by the client. Either its known IP address, or 0.0.0.0.
<dt>
Your IP Address
<dd>Set by the server if the Client IP address field was 0.0.0.0.
<dt>
Server IP address
<dd>Set by the server.
<dt>
Router IP address
<dd>Set by the forwarding router if BOOTP forwarding is being used.
<dt>
Client hardware address
<dd>Set by the client. DHCP defines a ``client identifier'' option which is
used for client identification. If this option is not used the client is
identified by its MAC address.
<dt>
Server host name
<dd>Optional server host name terminated by X'00'.
<dt>
Boot file name
<dd>The client either leaves this null or specifies a generic name, like
``router'' indicating the type of boot file to be used. In a DHCPDISCOVER
request this is set to null. The server returns a fully-qualified
directory-path name in a DHCPOFFER request. The value is terminated by X'00'.
<dt>
Options
<dd>The first four bytes of the options field of the DHCP message contain the
``magic cookie'' (99.130.83.99). The remainder of the <i>options</i> field
consists of tagged parameters that are called <i>options</i>. Please see RFC
1533 for details.
</dl>

<h4><a name="H763">4.18.0.1  Configuration Parameters Repository</a>
</h4>
<p>DHCP provides persistent storage of network parameters for network clients.
The model of DHCP persistent storage is that the DHCP service stores a
key-value entry for each client, where the key is some unique identifier, for
example an IP subnet number and a unique identifier within the subnet, and the
value contains the configuration parameters for this particular client.

<h4><a name="allocnu">4.18.0.2  Allocating a New Network Address</a>
</h4>
<p>This section describes the client/server interaction if the client does not
know its network address. Assume that the DHCP server has a block of network
addresses from which it can satisfy requests for new addresses. Each server
also maintains a database of allocated addresses  and leases in permanent local
storage.
<ol>
<li>The client broadcasts a DHCPDISCOVER message on its local physical subnet.
The DHCPDISCOVER message may include some options like network address
suggestion or lease duration etc.
<li>Each server may respond with a DHCPOFFER message that includes an available
network address and other configuration options.
<li>The client receives one or more DHCPOFFER messages from one or more
servers. The client chooses one based on the configuration parameters offered
and broadcasts a DHCPREQUEST message which includes the ``server identifier''
option to indicate which message it has selected.
<li>The servers receive the DHCPREQUEST broadcast from the client. Those
servers not selected by the DHCPREQUEST message use the message as notification
that the client has declined that server's offer. The server selected in the
DHCPREQUEST message commits the binding for the client to persistent storage
and responds with a DHCPACK message containing the configuration parameters for
the  requesting client. The combination of client hardware and assigned network
address constitute a unique identifier for the client's lease and are used by
both the client and server to identify a lease referred to in any DHCP
messages. The "your IP address" field in the DHCPACK messages is filled in with
the selected network address.
<li>The client receives the DHCPACK message with configuration parameters. The
client performs a final check on the parameters, for example with ARP for
allocated network address, and notes the duration of the lease and the lease
identification cookie specified in the DHCPACK message. At this point, the
client is configured. If the client detects a problem with the parameters in
the DHCPACK message, the client sends a DHCPDECLINE message to the server and
restarts the configuration process. The client should wait a minimum of ten
seconds before restarting the configuration process to avoid excessive network
traffic in case of looping.
<p>If the client receives a DHCPNAK message, the client restarts the
configuration process.
<li>The client may choose to relinquish its lease on a network address by
sending a DHCPRELEASE message to the server. The client identifies the lease to
be released by including its network address and its hardware address.
</ol>

<h4><a name="H765">4.18.0.3  Reusing a Previously Allocated Network Address</a>
</h4>
<p>If the client remembers and wishes to reuse a previously allocated network
address then the following steps are processed:
<ol>
<li>The client broadcasts a DHCPREQUEST message on its local subnet. The
DHCPREQUEST message includes the client's network address.
<li>Servers with knowledge of the client's configuration parameters respond
with a DHCPACK message to the client.
<li>The client receives the DHCPACK message with configuration parameters. The
client performs a final check on the parameters and notes the duration of the
lease and the lease identification cookie specified in the DHCPACK
message. At this point, the client is configured.
<p>If the client detects a problem with the parameters in the DHCPACK message,
the client sends a DHCPDECLINE message to the server and restarts the
configuration process by requesting a new network address. If the client
receives a DHCPNAK message, it cannot reuse its remembered network address. It
must instead request a new address by restarting the configuration process as
described in <a href="3376c418.html#allocnu">Allocating a New Network
Address</a>. The client may choose to relinquish its lease on a network address
by sending a DHCPRELEASE message to the server. The client identifies the lease
to be released with the lease identification cookie.
</ol>
<p><b>Note:</b> A host should use DHCP to reacquire or verify its IP address
and network parameters whenever the local network parameters have changed, for
example at system boot time or after a disconnection from the local network, as
the local network configuration may change without the host's or user's
knowledge.
<p>For further information please refer to the above mentioned RFCs.

<p><a href="./3376fm.html"><img src="fm2html-toc.gif">Table of Contents</a>  <a href="3376c419.html#netstat"><img src="fm2html-next.gif">NETSTAT</a><br>
</html>
